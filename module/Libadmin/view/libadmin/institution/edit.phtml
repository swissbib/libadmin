<?php
$this->headTitle($title);

$form = $this->customform;
$form->prepare();

$institution = $form->get('institution');

$idInstitution = (int)$institution->get('id')->getValue();
$isNew = !$idInstitution;

$saveButtonLabel = $this->translate($isNew ? 'action_create' : 'action_save', 'Libadmin');

$formType = 'horizontal';
$form->setAttribute('class', 'form-horizontal');

// Force Libadmin text domain (@todo cleaner way?)
//todo: find another way for translations
//$this->formLabelTwb()->setTranslatorTextDomain('Libadmin');
$this->formLabel()->setTranslatorTextDomain('Libadmin');
//$this->formSelectTwb()->setTranslatorTextDomain('Libadmin');

?>
<?= $this->form()->openTag($form) ?>
	<div class="topButtons">
		<input type="submit" value="<?= $this->escapeHtml($saveButtonLabel) ?>"
			   class="submitButton btn btn-primary btn-medium" id="submitbutton" name="submit">
		<a href="<?= $this->url('institution', array('action' => 'home')); ?>"
		   class="ajaxButton closeButton btn btn-medium" id="closebutton">
			<?= $this->translate('action_close', 'Libadmin') ?>
		</a>
		<?php if (!$isNew): ?>
			<a href="<?= $this->url('institution', array('action' => 'delete', 'id' => $idInstitution)); ?>"
			   class="ajaxButton deleteButton btn btn-danger btn-medium" id="deletebutton">
				<?= $this->translate('action_delete', 'Libadmin') ?>
			</a>
		<?php endif; ?>
	</div>

	<h1><?php echo $this->escapeHtml($title); ?></h1>

<?= $this->flashMessenger()->render() ?>

	<fieldset class="general">
		<legend><?= $this->translate('general', 'Libadmin') ?></legend>
		<div class="row-fluid">
			<div class="span5"><?= $this->formRow($institution->get('bib_code')) ?></div>
			<div class="span5"><?= $this->formRow($institution->get('sys_code')) ?></div>
			<div class="span2"><?= $this->formRow($institution->get('is_active')) ?></div>
		</div>
	</fieldset>

	<div class="tabbable">
		<ul class="nav nav-tabs formTabs">
			<li class="active"><a href="#display"><?= $this->translate('display', 'Libadmin') ?></a></li>
			<li><a href="#address"><?= $this->translate('address', 'Libadmin') ?></a></li>
			<li><a href="#relations"><?= $this->translate('groups_and_views', 'Libadmin') ?></a></li>
		</ul>

		<div class="tab-content">
			<div class="tab-pane active" id="display">
				<fieldset>
					<legend><?= $this->translate('displaynames', 'Libadmin') ?></legend>
					<div class="row-fluid">
						<div class="span6"><?= $this->formRow($institution->get('label_de')) ?></div>
						<div class="span6"><?= $this->formRow($institution->get('label_fr')) ?></div>
					</div>
					<div class="row-fluid">
						<div class="span6"><?= $this->formRow($institution->get('label_it')) ?></div>
						<div class="span6"><?= $this->formRow($institution->get('label_en')) ?></div>
					</div>
				</fieldset>

				<fieldset>
					<legend><?= $this->translate('title_library_names_official', 'Libadmin') ?></legend>
					<div class="row-fluid">
						<div class="span6"><?= $this->formRow($institution->get('name_de')) ?></div>
						<div class="span6"><?= $this->formRow($institution->get('name_fr')) ?></div>
					</div>
					<div class="row-fluid">
						<div class="span6"><?= $this->formRow($institution->get('name_it')) ?></div>
						<div class="span6"><?= $this->formRow($institution->get('name_en')) ?></div>
					</div>
				</fieldset>

				<fieldset>
					<legend>URL Bibliotheksinformationen</legend>
					<div class="row-fluid">
						<div class="span6">
							<?= $this->formRow($institution->get('url_de')) ?>
						</div>
						<div class="span6">
							<?= $this->formRow($institution->get('url_fr')) ?>
						</div>
					</div>
					<div class="row-fluid">
						<div class="span6">
							<?= $this->formRow($institution->get('url_it')) ?>
						</div>
						<div class="span6">
							<?= $this->formRow($institution->get('url_en')) ?>
						</div>
					</div>
				</fieldset>

				<fieldset class="notes">
					<legend><?= $this->translate('notes', 'Libadmin') ?></legend>
					<?= $this->formRow($institution->get('notes')) ?>
				</fieldset>

			</div>

			<div class="tab-pane" id="address">

				<fieldset class="address">
					<legend>Adresse</legend>
					<div class="row-fluid">
						<div class="span6"><?= $this->formRow($institution->get('address')) ?></div>
						<div class="span6">
							<?= $this->formRow($institution->get('zip')) ?>
							<?= $this->formRow($institution->get('city')) ?>
							<?= $this->formRow($institution->get('country')) ?>
							<?= $this->formRow($institution->get('canton')) ?>
						</div>
					</div>
				</fieldset>

				<fieldset class="contact">
					<legend><?= $this->translate('contactdata', 'Libadmin') ?></legend>
					<div class="row-fluid">
						<div class="span6">
							<?= $this->formRow($institution->get('website')) ?>
							<?= $this->formRow($institution->get('email')) ?>
							<?= $this->formRow($institution->get('phone')) ?>
						</div>
						<div class="span6">
							<?= $this->formRow($institution->get('skype')) ?>
							<?= $this->formRow($institution->get('facebook')) ?>
							<?= $this->formRow($institution->get('coordinates')) ?>
							<?= $this->formRow($institution->get('isil')) ?>
						</div>
					</div>
				</fieldset>
			</div>

			<div class="tab-pane" id="relations">
				<div class="row">
					<div class="span3 view">
						<legend><?= $this->translate('views', 'Libadmin') ?></legend>
					</div>
					<div class="span4 group">
						<legend><?= $this->translate('groups', 'Libadmin') ?></legend>
					</div>
					<div class="span2 favorite">
						<legend><?= $this->translate('is_favorite', 'Libadmin') ?>?</legend>
					</div>
				</div>

				<?php foreach ($institution->get('relations') as $relationFieldset): ?>
					<div class="row">
						<div class="span3 view">
							<?= $this->formRow($relationFieldset->get('id_view')) ?>
						</div>
						<div class="span4 group">
							<?= $this->formRow($relationFieldset->get('id_group')) ?>
						</div>
						<div class="span2 favorite">
							<?= $this->formRow($relationFieldset->get('is_favorite')) ?>
						</div>
					</div>
				<?php endforeach; ?>
			</div>
		</div>
	</div>

<?= $this->form()->closeTag(); ?>